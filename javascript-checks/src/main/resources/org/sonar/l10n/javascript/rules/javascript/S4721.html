<p>操作系统命令是安全敏感的。例如，它们的使用在过去曾导致以下漏洞:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12465">CVE-2018-12465</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7187">CVE-2018-7187</a> </li>
</ul>
<p>执行操作系统命令或执行与底层系统交互的命令的应用程序应该中和用于构造这些命令的任何外部提供的输入。如果不这样做，攻击者可能会执行意外的或危险的命令，从而可能导致机密性、完整性或可用性的丢失。</p>
<p> </p>
<p>此规则标记指定要运行的命令名称的代码。目标是指导安全代码审查。</p>
<h2>问问你自己是否</h2>
<ul>
  <li> 执行的命令由受外部影响的输入构造，例如，用户输入(攻击者)。(*) </li>
  <li> 命令的执行并不局限于正确的用户。(*)</li>
  <li> 可以重新设计应用程序，使其不依赖外部输入来执行命令。 </li>
</ul>
<p>(*) 如果你对其中任何一个问题的回答是肯定的，那么你就有风险。</p>
<p> </p>
<h2>推荐的安全编码实践</h2>
<p>限制用户对执行的命令的控制:</p>
<ul>
  <li> 将执行的命令作为白名单的一部分，并拒绝不属于此列表的所有命令。 </li>
  <li> 清理用户输入。 </li>
</ul>
<p> </p>
<p>限制哪些用户可以访问该命令:</p>
<ul>
  <li> 使用防火墙保护运行代码的进程，并保护网络不受命令的影响。 </li>
  <li> 对用户进行身份验证，只允许部分用户运行命令。 </li>
</ul>
<p>减少命令所能造成的伤害:</p>
<ul>
  <li> 在沙箱环境中执行代码，沙箱环境强制执行操作系统和流程之间的严格边界。例如： "jail".
  </li>
  <li> 如果进程拥有太多特权，则拒绝运行该命令。例如:禁止以“root”运行代码。 </li>
</ul>
<p> </p>
<h2>有问题的代码示例</h2>
<pre>
const cp = require('child_process');

// 下面的方法调用有问题。验证参数字符串。
cp.exec(str);
cp.execSync(str);

// 如果将shell参数设置为true，下面的方法调用就有问题了。
cp.spawn(str, { shell: true });
cp.spawnSync(str, { shell: true });
cp.execFile(str, { shell: true });
cp.execFileSync(str, { shell: true });
</pre>
<h2>例外</h2>
<p>如果传递的字符串是完全硬编码的，则不会引发任何问题。</p>
<h2>请参阅</h2>
<ul>
  <li> <a href="http://cwe.mitre.org/data/definitions/78">MITRE, CWE-78</a> - Improper Neutralization of Special Elements used in an OS Command </li>
  <li> OWASP Top 10 2017 Category A1 - Injection </li>
  <li> <a href="https://www.sans.org/top25-software-errors/#cat1">SANS Top 25</a> - Insecure Interaction Between Components </li>
</ul>

